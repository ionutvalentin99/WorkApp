{% extends 'base.html.twig' %}

{% block title %}Work App | Settings{% endblock %}

{% block body %}
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-xl-10">
                <h1 class="h2 fw-bold mb-4">Settings</h1>

                <div class="row">
                    {% include 'PageElements/_account_sidebar.html.twig' %}

                    <div class="col-12 col-lg-9">
                        <div class="card border-0 shadow-sm bg-light">
                            <div class="card-body p-4 p-md-5">

                                {% if app.request.query.get('error') %}
                                    <div class="alert alert-danger">{{ app.request.query.get('error') }}</div>
                                {% endif %}

                                <h2 class="h4 fw-bold mb-3">Account</h2>
                                <hr class="mb-4 text-secondary opacity-25">

                                <div class="mb-4">
                                    <h5 class="fw-bold">Name</h5>
                                    <p class="text-muted mb-3">Your name is <strong>{{ app.user.firstName }} {{ app.user.lastName }}</strong></p>

                                    <form action="{{ path('app_change_name') }}" method="post">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="first-name" class="form-label small text-muted">First Name</label>
                                                <input type="text" name="first-name" id="first-name" required
                                                       class="form-control"
                                                       placeholder="Your first name...">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="last-name" class="form-label small text-muted">Last Name</label>
                                                <input type="text" name="last-name" id="last-name" required
                                                       class="form-control"
                                                       placeholder="Your last name...">
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <button type="submit" class="btn btn-primary">Change Name</button>
                                        </div>
                                    </form>
                                </div>

                                <hr class="my-4 text-secondary opacity-25">

                                <div class="mb-4">
                                    <h5 class="fw-bold">Username</h5>
                                    <p class="text-muted mb-3">Your username is <strong>{{ app.user.username }}</strong></p>

                                    <form action="{{ path('app_change_username') }}" method="post">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label for="username" class="form-label small text-muted" id="username-availability">
                                                    Change your username:
                                                </label>
                                                <input type="text" name="username" id="username" required minlength="3"
                                                       class="form-control"
                                                       placeholder="New username...">
                                            </div>
                                        </div>

                                        <input type="hidden" name="is_username_available" id="is_username_available" value="false">
                                        <div class="mt-3">
                                            <button type="submit" class="btn btn-primary" id="change-username-button">
                                                Change Username
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <hr class="my-4 text-secondary opacity-25">

                                <div class="mb-4 d-flex align-items-center justify-content-between flex-wrap gap-2">
                                    <div>
                                        <h5 class="fw-bold mb-1">Email Address</h5>
                                        <p class="text-muted mb-0">Your email address is <strong>{{ userEmail }}</strong></p>
                                    </div>
                                    <a href="{{ path('app_change_email') }}" class="btn btn-link fw-bold text-decoration-none px-0">
                                        Change
                                    </a>
                                </div>

                                <hr class="my-4 text-secondary opacity-25">

                                <div class="mb-4">
                                    <form action="{{ path('app_change_password') }}" method="post">
                                        <h5 class="fw-bold mb-3">Password</h5>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="current-password" class="form-label small text-muted">Current Password</label>
                                                <input type="password" name="current-password" id="current-password" required
                                                       class="form-control"
                                                       placeholder="***********">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="new-password" class="form-label small text-muted">New Password</label>
                                                <input type="password" name="new-password" id="new-password" required
                                                       class="form-control"
                                                       placeholder="***********">
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <button type="submit" class="btn btn-primary" id="reset-password-button">Save Password</button>
                                        </div>
                                    </form>
                                </div>

                                <hr class="my-4 text-secondary opacity-25">

                                <div class="mb-2">
                                    <div class="d-flex align-items-center gap-2 mb-2">
                                        <h5 class="fw-bold mb-0">Delete Account</h5>
                                        <span class="badge rounded-pill bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25">
                                            Proceed with caution
                                        </span>
                                    </div>
                                    <p class="text-muted small">
                                        Make sure you have taken backup of your account in case you ever need to get access to your data.
                                        We will completely wipe your data. There is no way to access your account after this action.
                                    </p>

                                    <form action="{{ path('app_delete_account') }}" method="post"
                                          onsubmit="return confirm('Are you sure you want to delete your account?');"
                                          class="d-flex justify-content-end mt-3">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete-user') }}">
                                        <button type="submit" class="btn btn-outline-danger fw-bold btn-sm">
                                            Delete Account
                                        </button>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/username-check.js') }}"></script>
{% endblock %}